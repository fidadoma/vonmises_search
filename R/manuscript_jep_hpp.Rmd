---
title: "manuscript - JEP:HPP"
author: "Filip Dechterenko"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: html_document
---

## Load libraries

```{r load libraries}
library(tidyverse); theme_set(theme_bw(16))
library(ez)
library(psyphy)

source("tools.R")

```

# Experiment 1

```{r load data - exp 1}
load("../data/exp1/responses/responses_150330.RData")

df_exp1 <- filter(df, block != 0) 

participants_exp1 <- read.csv("../data/exp1/participants_150526.csv")

# originally, we colledcted three levels of variaiblity, but the condition with kappa=64 showed similar results as kappa = 16
df_exp1 <- filter(df_exp1, restk != "64") %>% as_data_frame()
```


## Participant info
```{r}
table(participants_exp1$gender)
c(mean(participants_exp1$age), sd(participants_exp1$age)) %>% round(2)
```

## Results

```{r}
df_exp1 %>% group_by(restk) %>% summarize(accuracy_mean = mean(accuracy, na.rm = T) %>% round(2))
```

## Figure 1

```{r Figure 1}
traj_k64 <- read.table("../data/exp1/trajectories/T001_64_rest4.csv") %>% select(x = V1,y = V2) %>% as_data_frame()
p1 <- traj_k64 %>% ggplot(aes(x,y)) + geom_point() + theme(aspect.ratio = 1) + xlim(-15,15)+ylim(-15,15) +
  ggtitle("Ballistic-like")

traj_k4 <- read.table("../data/exp1/trajectories/T001_4_rest4.csv") %>% select(x = V3,y = V4) %>% as_data_frame()
p2 <- traj_k4 %>% ggplot(aes(x,y)) + geom_point() + theme(aspect.ratio = 1) + xlim(-15,15)+ylim(-15,15)+
  ggtitle("Brownian-like")
gridExtra::grid.arrange(p1,p2, ncol = 2)
ggsave("Figure1_ballistic.png", p1, width = 6, height = 6)
ggsave("Figure1_brownian.png", p2, width = 6, height = 6)
ggsave("Figure1_ballistic.eps", p1, width = 6, height = 6)
ggsave("Figure1_brownian.eps", p2, width = 6, height = 6)
```

## Figure 2

```{r Figure 2}
p1 <- df_exp1 %>%
  filter(restk == 4) %>%
  ggplot(aes(x = type, y = accuracy)) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = 1)) + 
  geom_hline(yintercept=0.125) + 
  theme(aspect.ratio = 1)  + xlab(expression("Target's"~kappa)) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  scale_x_continuous(expression("Target's"~kappa~" (log scale)"),breaks = c(1,8,16,32,64,128),labels = c("1","8","16","32","64","128"), trans = "log2") + 
  geom_vline(xintercept = 4, linetype = 2) +
  ggtitle("Brownian-like-distractors")
p2 <- df_exp1 %>%
  filter(restk == 16) %>%
  ggplot(aes(x = type, y = accuracy)) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = 1)) + 
  geom_hline(yintercept=0.125) + 
  theme(aspect.ratio = 1)  + 
  ylab("Accuracy") + 
  ylim(0,1)+
  scale_x_continuous(expression("Target's"~kappa~" (log scale)"),breaks = c(1,8,16,32,64,128),labels = c("1","8","16","32","64","128"), trans = "log2") + 
  geom_vline(xintercept = 16, linetype = 2) +
  ggtitle("Ballistic-like-distractors")
gridExtra::grid.arrange(p1,p2, ncol = 2)

ggsave("plots/Figure2_brownian.png", p1, width = 6, height = 6)
ggsave("plots/Figure2_ballistic.png", p2, width = 6, height = 6)
ggsave("plots/Figure2_brownian.eps", p1, width = 6, height = 6)
ggsave("plots/Figure2_ballistic.eps", p2, width = 6, height = 6)
```

```{r fitting weibull}

df.pf <- filter(df_exp1, restk == 16, type %in% c(2,4,8,16,32))
df.pf$type <- as.numeric(levels(df.pf$type))[df.pf$type]

df.pf2 <- df.pf %>% group_by(type) %>% summarise(yes = sum(accuracy), no = n()-sum(accuracy),accuracy=1-mean(accuracy))

pf <- psyfun.2asym(cbind(yes, no) ~ type,data = df.pf2, link = weib.2asym, init.g = 0.125, init.lam = 0.05 )   
x <- seq(-2,32,0.01)
y <- predict(pf, data.frame(type = x), type="response")

dfmodel <- data.frame(x,y)

p <- ggplot(data = dfmodel, aes(x = x, y = y)) + geom_line(color="red", size =1.5) + stat_summary(data = df.pf, aes(x = type, y=accuracy),fun.data = "mean_cl_boot", size = 1) + scale_x_continuous(expression("Target's"~kappa), breaks = df.pf2$type) + ylab("Accuracy")
p

```

Test with baseline

```{r}
df_exp1 %>% group_by(type, restk,subject) %>% summarize(accuracy = mean(accuracy)) %>% group_by(restk, type) %>% filter(accuracy <1) %>% do(t.test(.$accuracy, mu = .125) %>% broom::tidy()) %>% mutate(p.value = round(p.value, 3)) %>% knitr::kable()
```

Difference between symmetrical cases
```{r}
df.sym <- df_exp1 %>% filter((restk == 4 & type == 16) |(restk == 16 & type == 4))
ez::ezANOVA(df.sym,
        dv=accuracy,
        wid = subject,
        within = restk)
```


# Experiment 2

```{r load data - experiment 2}
load("../data/exp1_fin/responses/responses_150622.RData")
df_exp2 <- filter(df, block != 0) 

participants_exp2 <- read.csv("../data/exp1_fin/participants_150526.csv", fileEncoding = "UTF8")

df2_exp2 <- rbind(df_exp2,df_exp2)
df2_exp2$version <- 2
df2_exp2$version[1:nrow(df_exp2)] <- 1

# this is a little hack, just to make a correct ggplot with one line
tmp <- df_exp2$restk
df2_exp2$restk[df2_exp2$version == 2] <- df_exp2$type
df2_exp2$type[df2_exp2$version == 2] <- tmp

df2_exp2$version <- factor(df2_exp2$version, labels = c("fix distractors' k", "fix target's k"))
```

## Participant info
```{r}
table(participants_exp2$gender)
c(mean(participants_exp2$age), sd(participants_exp2$age)) %>% round(2)
```

## Figure 3

```{r plots experiment 2}


p_k2 <- df2_exp2 %>%
  filter(restk == 2) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous(expression(kappa~"of the others (log scale)"),breaks = c(2,4,8,16,64),labels = c("2","4","8","16","64"), trans = "log2") + 
  scale_linetype_manual(values = c(2,1)) +
  geom_vline(xintercept = 2, linetype = 2) +
  ggtitle(expression("Fixed "~kappa~"= 2"))

p_k4 <- df2_exp2 %>%
  filter(restk == 4) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous(expression(kappa~"of the others (log scale)"),breaks = c(2,4,8,16,64),labels = c("2","4","8","16","64"), trans = "log2") + 
  scale_linetype_manual(values = c(2,1)) +
  geom_vline(xintercept = 4, linetype = 2) +
  ggtitle(expression("Fixed "~kappa~"= 4"))

p_k8 <- df2_exp2 %>%
  filter(restk == 8) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous(expression(kappa~"of the others (log scale)"),breaks = c(2,4,8,16,64),labels = c("2","4","8","16","64"), trans = "log2") + 
  scale_linetype_manual(values = c(2,1)) +
  geom_vline(xintercept = 8, linetype = 2) +
  ggtitle(expression("Fixed "~kappa~"= 8"))

p_k16 <- df2_exp2 %>%
  filter(restk == 16) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous(expression(kappa~"of the others (log scale)"),breaks = c(2,4,8,16,64),labels = c("2","4","8","16","64"), trans = "log2") + 
  scale_linetype_manual(values = c(2,1)) +
  geom_vline(xintercept = 16, linetype = 2) +
  ggtitle(expression("Fixed "~kappa~"= 16"))

p_k64 <- df2_exp2 %>%
  filter(restk == 64) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous(expression(kappa~"of the others (log scale)"),breaks = c(2,4,8,16,64),labels = c("2","4","8","16","64"), trans = "log2") + 
  scale_linetype_manual(values = c(2,1)) +
  geom_vline(xintercept = 64, linetype = 2) +
  ggtitle(expression("Fixed "~kappa~"= 64"))

p_k64_legend <- df2_exp2 %>%
  filter(restk == 64) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  scale_x_continuous(expression(kappa~"of the others (log scale)"),breaks = c(2,4,8,16,64),labels = c("2","4","8","16","64"), trans = "log2") + 
  scale_linetype_manual(values = c(2,1)) +
  geom_vline(xintercept = 64, linetype = 2) +
  ggtitle(expression("Fixed "~kappa~"= 64"))

gridExtra::grid.arrange(p_k2,p_k4, p_k8, p_k16, p_k64, ncol = 5)
ggsave("plots/Fig3_k2.eps", p_k2, width = 6, height = 6)
ggsave("plots/Fig3_k4.eps", p_k4, width = 6, height = 6)
ggsave("plots/Fig3_k8.eps", p_k8, width = 6, height = 6)
ggsave("plots/Fig3_k16.eps", p_k16, width = 6, height = 6)
ggsave("plots/Fig3_k64.eps", p_k64, width = 6, height = 6)
ggsave("plots/Fig3_k64_legend.eps", p_k64_legend, width = 6, height = 6)
# final plot was created in inkscape
```

## Compute the asymmetry

```{r compute the assymetry, warning=F}
df3_exp2 <- df2_exp2 %>% group_by(type, restk) %>% do(p=compute.p(.))

df3_exp2$p <- unlist(df3_exp2$p) %>% round(3)
df4_exp2 <- df2_exp2 %>% group_by(type, restk) %>% do(ges=compute.des(.))
df4_exp2$ges <- unlist(df4_exp2$ges) %>% round(2)
df3_exp2$ges <- df4_exp2$ges

df5_exp2 <- df2_exp2 %>% group_by(type, restk, version) %>% summarize(accuracy = mean(accuracy)) %>% 
  group_by(type, restk) %>%
  summarize(acc_diff = accuracy[version == "fix distractors' k"] - accuracy[version == "fix target's k"])

m <- matrix(df3_exp2$ges, nrow = 5)
rownames(m) <- levels(df_exp2$type)
colnames(m) <- levels(df_exp2$type)
m[upper.tri(m,diag = T)] <- NA

df3_exp2$ges <- as.vector(m)

m <- matrix(df3_exp2$p, nrow = 5)
m[upper.tri(m, diag = T)] <- NA
df3_exp2$p <- as.vector(m)

m <- matrix(df5_exp2$acc_diff, nrow = 5)
m[upper.tri(m, diag = T)] <- NA
df3_exp2$acc_diff <- as.vector(m)


df3_exp2$target_lower_than_dist <- df3_exp2$acc_diff < 0
df3_exp2 %>% filter(target_lower_than_dist)

df3_exp2 %>% filter(p < .05)
```

Test with baseline

```{r}
df_exp2 %>% group_by(type, restk,subject) %>% summarize(accuracy = mean(accuracy)) %>% group_by(restk, type) %>% filter(accuracy <1) %>% do(t.test(.$accuracy, mu = .125) %>% broom::tidy()) %>% mutate(p.value = round(p.value, 3)) %>% knitr::kable()
```


# Experiment 3

```{r load data - exp 3}
load("../data/exp2/responses/responses_150410.RData")
df_exp3 <- filter(df, block != 0) 
df_exp3 <- df_exp3 %>% mutate(restk = restk * 100, type = type * 100)
participants <- read.csv("../data/exp2/participants_171023.csv")
```

## Participant info
```{r exp3 participant info}
table(participants_exp3$gender)
c(mean(participants_exp3$age), sd(participants_exp3$age)) %>% round(2)
```

## Results

```{r}
df_exp3 %>% group_by(restk) %>% summarize(accuracy_mean = mean(accuracy, na.rm = T) %>% round(2))
```

## Figure 4

```{r}
p1 <- df_exp3 %>%
  filter(restk == 2) %>%
  ggplot(aes(x = type, y = accuracy)) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = 1)) + 
  geom_hline(yintercept=0.125) + 
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  geom_vline(xintercept = 2, linetype = 2) +
  scale_x_continuous("Target's speed (log scale)",breaks = c(0.5,1,2,3,4,6,8),labels = c("0.5","1","2","3","4","6","8"), trans = "log2") + 
  ggtitle("Slow-moving-distractors")
p2 <- df_exp3 %>%
  filter(restk == 4) %>%
  ggplot(aes(x = type, y = accuracy)) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = 1)) + 
  geom_hline(yintercept=0.125) + 
  theme(aspect.ratio = 1)  + 
  ylab("Accuracy") + 
  ylim(0,1)+
  geom_vline(xintercept = 4, linetype = 2) +
  scale_x_continuous("Target's speed (log scale)",breaks = c(0.5,1,2,3,4,6,8),labels = c("0.5","1","2","3","4","6","8"), trans = "log2") + 
  ggtitle("Fast-moving-distractors")
gridExtra::grid.arrange(p1,p2, ncol = 2)

ggsave("plots/Figure4_slow.png", p1, width = 6, height = 6)
ggsave("plots/Figure4_fast.png", p2, width = 6, height = 6)
ggsave("plots/Figure4_slow.eps", p1, width = 6, height = 6)
ggsave("plots/Figure4_fast.eps", p2, width = 6, height = 6)
```

## Statistics

```{r exp 3 - statistics}
df_exp3 %>% group_by(restk) %>% summarize(acc = mean(accuracy) * 100, sd = sd(accuracy) *100)
```

```{r exp 3 - symmetric conditions}
df_cond1 <- df_exp3 %>% filter(type == 2 & restk == 4)
df_cond2 <- df_exp3 %>% filter(type == 4 & restk == 2) 
```

Difference between symmetrical cases
```{r}
df_sym <- df_exp3 %>% filter((restk == 2 & type == 4) |(restk == 4 & type == 2))
ez::ezANOVA(df_sym,
        dv=accuracy,
        wid = subject,
        within = restk)
ez::ezStats(df_sym,
        dv=accuracy,
        wid = subject,
        within = restk)

```

Test with baseline

```{r}
df_exp3 %>% group_by(type, restk,subject) %>% summarize(accuracy = mean(accuracy)) %>% group_by(restk, type) %>% filter(accuracy <1) %>% do(t.test(.$accuracy, mu = .125) %>% broom::tidy()) %>% mutate(p.value = round(p.value, 3)) %>% knitr::kable()
```



# Experiment 4

```{r load data - exp 4}
load("../data/exp2_fin/responses/responses_171023.RData")

df_exp4 <- filter(df, block != 0) 
df_exp4 <- df_exp4 %>% mutate(restk = restk * 100, type = type * 100)
rm(df)

participants_exp4 <- read.csv("../data/exp2_fin/participants_171023.csv")

df2_exp4 <- rbind(df_exp4, df_exp4)
df2_exp4$version <- 2
df2_exp4$version[1:nrow(df_exp4)] <- 1

# this is a little hack, just to make a correct ggplot with one line
tmp <- df_exp4$restk
df2_exp4$restk[df2_exp4$version == 2] <- df_exp4$type
df2_exp4$type[df2_exp4$version == 2] <- tmp

df2_exp4$version <- factor(df2_exp4$version, labels = c("fix distractors' speed", "fix target's speed"))
```

## Participant info
```{r exp4 - participants info}
table(participants_exp4$gender)
c(mean(participants_exp4$age), sd(participants_exp4$age)) %>% round(2)
```

## Figure 5

```{r Figure 5}

p_sp05 <- df2_exp4 %>%
  filter(restk == .5) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous("Speed of the others (log scale)",breaks = c(.5,1,2,4,8),labels = c(".5","1","2","4","8"),
                     trans = "log2") + 
  geom_vline(xintercept = .5, linetype = 2) +
  ggtitle(expression("Fixed speed = 0.5"*degree*"/s"))

p_sp1 <- df2_exp4 %>%
  filter(restk == 1) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous("Speed of the others (log scale)",breaks = c(.5,1,2,4,8),labels = c(".5","1","2","4","8"),
                     trans = "log2") + 
  geom_vline(xintercept = 1, linetype = 2) +
  ggtitle(expression("Fixed speed = 1"*degree*"/s"))

p_sp2 <- df2_exp4 %>%
  filter(restk == 2) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous("Speed of the others (log scale)",breaks = c(.5,1,2,4,8),labels = c(".5","1","2","4","8"),
                     trans = "log2") + 
  geom_vline(xintercept = 2, linetype = 2) +
  ggtitle(expression("Fixed speed = 2"*degree*"/s"))

p_sp4 <- df2_exp4 %>%
  filter(restk == 4) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous("Speed of the others (log scale)",breaks = c(.5,1,2,4,8),labels = c(".5","1","2","4","8"),
                     trans = "log2") + 
  geom_vline(xintercept = 4, linetype = 2) +
  ggtitle(expression("Fixed speed = 4"*degree*"/s"))

p_sp8 <- df2_exp4 %>%
  filter(restk == 8) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  theme(legend.position="none") +
  scale_x_continuous("Speed of the others (log scale)",breaks = c(.5,1,2,4,8),labels = c(".5","1","2","4","8"),
                     trans = "log2") + 
  geom_vline(xintercept = 8, linetype = 2) +
  ggtitle(expression("Fixed speed = 8"*degree*"/s"))

p_sp8_legend <- df2_exp4 %>%
  filter(restk == 8) %>%
  ggplot(aes(x = type, y = accuracy, group = version)) + 
  #facet_grid(~ restk) + 
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = mean, geom = "line", aes(group = version, linetype = version)) + 
  geom_hline(yintercept=0.125) +
  theme(aspect.ratio = 1) + 
  ylab("Accuracy") + 
  ylim(0,1)+
  scale_x_continuous("Speed of the others (log scale)",breaks = c(.5,1,2,4,8),labels = c(".5","1","2","4","8"),
                     trans = "log2") + 
  geom_vline(xintercept = 8, linetype = 2) +
  ggtitle(expression("Fixed speed = 8"*degree*"/s"))

gridExtra::grid.arrange(p_sp05,p_sp1, p_sp2, p_sp4, p_sp8, ncol = 5)
ggsave("plots/Fig5_sp05.eps", p_sp05, width = 6, height = 6)
ggsave("plots/Fig5_sp1.eps", p_sp1, width = 6, height = 6)
ggsave("plots/Fig5_sp2.eps", p_sp2, width = 6, height = 6)
ggsave("plots/Fig5_sp4.eps", p_sp4, width = 6, height = 6)
ggsave("plots/Fig5_sp8.eps", p_sp8, width = 6, height = 6)
ggsave("plots/Fig5_sp8_legend.eps", p_sp8_legend, width = 6, height = 6)
# final plot was created in inkscape
```

## Compute the asymmetry

```{r compute the assymetry, warning=F}
df3_exp4 <- df2_exp4 %>% group_by(type, restk) %>% do(p=compute.p(.))

df3_exp4$p <- unlist(df3_exp4$p) %>% round(3)
df4_exp4 <- df2_exp4 %>% group_by(type, restk) %>% do(ges=compute.des(.))
df4_exp4$ges <- unlist(df4_exp4$ges) %>% round(2)
df3_exp4$ges <- df4_exp4$ges

df5_exp4 <- df2_exp4 %>% group_by(type, restk, version) %>% summarize(accuracy = mean(accuracy)) %>% 
  group_by(type, restk) %>%
  summarize(acc_diff = accuracy[version == "fix distractors' speed"] - accuracy[version == "fix target's speed"])

m <- matrix(df3_exp4$ges, nrow = 5)
rownames(m) <- levels(df_exp4$type)
colnames(m) <- levels(df_exp4$type)
m[upper.tri(m,diag = T)] <- NA

df3_exp4$ges <- as.vector(m)

m <- matrix(df3_exp4$p, nrow = 5)
m[upper.tri(m, diag = T)] <- NA
df3_exp4$p <- as.vector(m)

m <- matrix(df5_exp4$acc_diff, nrow = 5)
m[upper.tri(m, diag = T)] <- NA
df3_exp4$acc_diff <- as.vector(m)


df3_exp4$target_lower_than_dist <- df3_exp4$acc_diff < 0
df3_exp4 %>% filter(target_lower_than_dist) 

df3_exp4 %>% filter(p < 0.05) 

differencies <- df3_exp4 %>% filter(target_lower_than_dist)  %>% .$acc_diff *-1
differencies %>% range() %>% round(2)

```

